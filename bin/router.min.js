!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Router=e()}(this,function(t,e,n){function o(t){for(var e=t.match(/:([^\/]+)/g),n=0,o=e?e.length:0;o>n;n++)e[n]=e[n].replace(/[:\(\)]/g,"");return e}function r(t){return t=t.replace(y,"\\$&").replace(p,"(?:$1)?").replace(g,function(t,e){return e?t:"([^/?]+)"}).replace(d,"([^?]*)"),new RegExp("^"+t+"(?:\\?*([^/]*))")}function i(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}function s(t,e){var n=t.exec(e).slice(1),o=n.map(function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null});return o}function a(t){var e,n,o;if("string"==typeof t){e={},n=t.split("&");for(var r=0;r<n.length;r++)o=n[r].split("="),e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}function c(t,e){var n={},o=t.length-1,r=t[o];if(e&&e.length>0){for(var i=0;i<e.length;i++)n[e[i]]=t[i];for(var s=e.length;s<t.length;s++)t[s]&&(n.query=a(t[s]));t=[n]}else r&&r.indexOf("=")>-1&&(t[o]=a(r));return t}function u(t){var e,n=null;return e=t.toString().replace(_,"").match(m)[1],e&&e.length>0&&e.split(",").forEach(function(t,e){"complete"===t.trim()&&(n=e)}),n}function l(){this._routes=[],this._options=JSON.parse(JSON.stringify(f))}var h=["node","hash","history"],f={mode:"node",keys:!0,root:"/",rerouting:!0},p=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,d=/\*\w+/g,y=/[\-{}\[\]+?.,\\\^$|#\s]/g,v=/.*/,m=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,_=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;l.prototype.add=function(t,e,n){var i,s;return"function"==typeof t?(n=e,e=t,s=v):(i=o(t),s=r(t)),this._routes.push({async:n&&"number"==typeof n.async?n.async:u(e),path:s,callback:e,keys:i,alias:n&&n.alias?n.alias:t,facade:null}),this._routes.sort(function(t,e){return e.alias.length-t.alias.length}),this},l.prototype.remove=function(t){for(var e,n=this._routes.length-1;e=this._routes[n];n--)if(t===e.alias||t===e.callback||t.toString()===e.path.toString())this._routes.splice(n,1);else if(e._routes.length>0)for(var o=e._routes.length-1;o>-1;o--)e._routes[o].remove(t);return this},l.prototype.check=function(t,e,n){for(var o,r,i,a,u,l=0;l<this._routes.length,i=this._routes[l];l++)if(o=t.match(i.path)){a=s(i.path,t),keys=this._options.keys?i.keys:null,a=c(a,keys),u=t.slice(0,o[0].length)!==n.slice(0,o[0].length),r={callback:i.callback,params:a,routes:[],async:i.async,rootRerouting:this._options.rerouting||u},e.push(r),i.facade&&(t=t.slice(o[0].length,t.length),n=n.slice(o[0].length,n.length),i.facade.check(t,r.routes,n));break}return e},l.prototype.drop=function(){return this._routes=[],this.config(f),this},l.prototype.config=function(t){return"object"==typeof t&&(this._options.keys="boolean"==typeof t.keys?t.keys:this._options.keys,this._options.mode=-1!==h.indexOf(t.mode)?t.mode:this._options.mode,this._options.root=t.root?"/"+i(t.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof t.rerouting?t.rerouting:this._options.rerouting),this},l.prototype.to=function(t){for(var e,n,o=0;o<this._routes.length,n=this._routes[o];o++)t===n.alias&&(e=n.facade,e||(n.facade=e=(new l).config(this._options)));return e};var k=function(t){function e(t){return function(e){e===!1?(s=!0,o.navigate(r)):"string"==typeof e?o.route(e):t&&t.length&&n(t)}}function n(t){var n;if(t)for(var o,r=0;r<t.length,o=t[r];r++)"number"==typeof o.async&&o.params.splice(o.async,0,e(o.routes)),o.rootRerouting&&(n=o.callback.apply(null,o.params)),"number"!=typeof o.async&&e(o.routes)(n)}var o={},r="",s=!1;return o.drop=function(){return r="",t.drop()},o.listen=function(){var t=this,e=this.getCurrent();clearInterval(this._interval),this._interval=setInterval(function(){var n=o.getCurrent();e!==n&&(e=n,t.check(t.getCurrent()))},50),window.onpopstate=function(e){null!==e.state&&void 0!==e.state&&(clearInterval(t._interval),t.check(t.getCurrent()))}},o.check=function(e){return n(t.check(e,[],r)),t},o.navigate=function(e){var n=t._options.mode;switch(n){case"history":history.pushState(null,null,t._options.root+i(e));break;case"hash":window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e;break;case"node":r=e}return t},o.route=function(e){return"node"===t._options.mode&&this.check(e),s||this.navigate(e),s=!1,t},o.config=function(e){return t.config(e)},o.to=function(e){return t.to(e)},o.add=function(e,n,o){return t.add(e,n,o)},o.remove=function(e){return t.remove(e)},o.getCurrent=function(){var e=t._options.mode,n=t._options.root,o=r;if("history"===e)o=i(decodeURI(location.pathname+location.search)),o=o.replace(/\?(.*)$/,""),o="/"!==n?o.replace(n,""):o;else if("hash"===e){var s=window.location.href.match(/#(.*)$/);o=s?s[1]:""}return o},o}(new l);return k});