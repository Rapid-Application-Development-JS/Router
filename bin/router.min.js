!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Router=e()}(this,function(t,e,o){function n(t){for(var e=t.match(/:([^\/]+)/g),o=0,n=e?e.length:0;n>o;o+=1)e[o]=e[o].replace(/[:\(\)]/g,"");return e}function r(t){return t=t.replace(y,"\\$&").replace(p,"(?:$1)?").replace(d,function(t,e){return e?t:"([^/?]+)"}).replace(g,"([^?]*)"),new RegExp("^"+t+"(?:\\?*([^/]*))")}function i(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}function s(t,e){var o=t.exec(e).slice(1);return o.map(function(t,e){return e===o.length-1?t||null:t?decodeURIComponent(t):null})}function c(t){var e,o,n;if("string"==typeof t){e={},o=t.split("&");for(var r=0;r<o.length;r++)n=o[r].split("="),e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}function a(t,e){var o={},n=t.length-1,r=t[n];if(e&&e.length>0){for(var i=0;i<e.length;i+=1)o[e[i]]=t[i];t[i]&&(o.query=c(t[i])),t=[o]}else r&&r.indexOf("=")>-1&&(t[n]=c(r));return t}function u(t){var e,o=null;return e=t.toString().replace(_,"").match(v)[1],e&&e.length>0&&e.split(",").forEach(function(t,e){"complete"===t.trim()&&(o=e)}),o}function l(){this._routes=[],this._options=JSON.parse(JSON.stringify(f))}var h=["node","hash","history"],f={mode:"node",keys:!0,root:"/",rerouting:!0},p=/\((.*?)\)/g,d=/(\(\?)?:\w+/g,g=/\*\w+/g,y=/[\-{}\[\]+?.,\\\^$|#\s]/g,m=/.*/,v=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,_=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;l.prototype.add=function(t,e,o){var i,s;return"function"==typeof t?(o=e,e=t,s=m):(i=n(t),s=r(t)),this._routes.push({async:u(e),path:s,callback:e,keys:i,alias:o||t,facade:null}),this},l.prototype.remove=function(t){for(var e,o=this._routes.length-1;e=this._routes[o];o-=1)(t===e.alias||t===e.callback||t.toString()===e.path.toString())&&this._routes.splice(o,1);return this},l.prototype.check=function(t,e,o){for(var n,r,i,c,u,l=0;l<this._routes.length,i=this._routes[l];l++)if(n=t.match(i.path)){c=s(i.path,t),keys=this._options.keys?i.keys:null,c=a(c,keys),u=t.slice(0,n[0].length)!==o.slice(0,n[0].length),r={callback:i.callback,params:c,routes:[],async:i.async,shouldRoute:this._options.rerouting||u},e.push(r),i.facade&&(t=t.slice(n[0].length,t.length),o=o.slice(n[0].length,o.length),i.facade.check(t,r.routes,o));break}return e},l.prototype.drop=function(){return this._routes=[],this.config(f),this},l.prototype.config=function(t){return"object"==typeof t&&(this._options.keys="boolean"==typeof t.keys?t.keys:this._options.keys,this._options.mode=-1!==h.indexOf(t.mode)?t.mode:this._options.mode,this._options.root=t.root?"/"+i(t.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof t.rerouting?t.rerouting:this._options.rerouting),this},l.prototype.to=function(t){for(var e,o,n=0;n<this._routes.length,o=this._routes[n];n+=1)t===o.alias&&(e=o.facade,e||(o.facade=e=(new l).config(this._options)));return e};var k=function(t){function e(t){function o(t){return function(){t.length&&e(t)}}if(t)for(var n,r=0;r<t.length,n=t[r];r+=1)"number"==typeof n.async&&n.params.splice(n.async,0,o(n.routes)),n.shouldRoute&&n.callback.apply(null,n.params),n.routes.length&&"number"!=typeof n.async&&e(n.routes)}function o(){var e="",o=t._options.mode,n=t._options.root;if("history"===o)e=i(decodeURI(location.pathname+location.search)),e=e.replace(/\?(.*)$/,""),e="/"!==n?e.replace(n,""):e;else if("hash"===o){var r=window.location.href.match(/#(.*)$/);e=r?r[1]:""}return i(e)}var n="";return{check:function(o){return e(t.check(o,[],n)),n=o,t},drop:function(){return n="",t.drop()},listen:function(){function t(){var t=o();n!==t&&(n=t,e.check(n))}var e=this,n=o();clearInterval(this._interval),this._interval=setInterval(function(){t()},50),window.onpopstate=function(o){null!==o.state&&void 0!==o.state&&(clearInterval(e._interval),t())}},navigate:function(e){var o=t._options.mode,n=t._options.root;e=e?e:"","history"===o?history.pushState(null,null,n+i(e)):(window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e)},config:function(e){return t.config(e)},to:function(e){return t.to(e)},add:function(e,o,n){return t.add(e,o,n)},remove:function(e){return t.remove(e)}}}(new l);return k});